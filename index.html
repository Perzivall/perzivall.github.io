<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cliente WebSocket Seguro</title>
</head>

<body>
    <h1>Cliente WebSocket Seguro</h1>
    <button id="sendButton">Selecionar Impressora</button>
    <button id="sendEscPosButton">Enviar ESC/POS</button>
    <p id="status">Status: Desconectado</p>

    <script>
        // Cria uma conexão WebSocket segura
        const socket = new WebSocket('ws://127.0.0.1:4000');

        // Evento quando a conexão é aberta
        socket.addEventListener('open', function (event) {
            document.getElementById('status').innerText = 'Status: Conectado';
        });

        // Evento para mensagens recebidas
        socket.addEventListener('message', function (event) {
            console.log('Mensagem recebida do servidor: ', event.data);
        });

        // Evento para erro
        socket.addEventListener('error', function (event) {
            console.error('Erro na conexão WebSocket: ', event);
            document.getElementById('status').innerText = 'Status: Erro na conexão';
        });

        // Evento para fechamento da conexão
        socket.addEventListener('close', function (event) {
            document.getElementById('status').innerText = 'Status: Conexão fechada';
        });

        // Função para enviar a mensagem ao clicar no botão "Selecionar Impressora"
        document.getElementById('sendButton').addEventListener('click', function () {
            if (socket.readyState === WebSocket.OPEN) {
                socket.send('select_printer');
                console.log('Mensagem enviada: select_printer');
            } else {
                console.error('A conexão WebSocket não está aberta.');
            }
        });

        // Função para converter texto ESC/POS em Base64 e enviar ao clicar no botão "Enviar ESC/POS"
        document.getElementById('sendEscPosButton').addEventListener('click', function () {
            if (socket.readyState === WebSocket.OPEN) {
    // Texto ESC/POS (exemplo)
const escPosText = new Uint8Array([
    0x1B, 0x40, // Inicializa a impressora
    0x1B, 0x45, 0x01, // Ativa o negrito
    ...new TextEncoder().encode("Texto em negrito"), // Texto
    0x1B, 0x45, 0x00, // Desativa o negrito
    0x0A // Nova linha
]);
    const base64String = btoa(String.fromCharCode.apply(null, escPosText)); // Converte para Base64

    socket.send(base64String);
    console.log('Mensagem enviada: ', base64String);
            } else {
                console.error('A conexão WebSocket não está aberta.');
            }
        });
    </script>
</body>
</html>
